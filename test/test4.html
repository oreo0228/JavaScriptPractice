<!DOCTYPE html>
<html>
  <head>
    <title>Mosaic Effect</title>
    <style>
      #canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <input type="file" id="fileInput" accept="image/*" />
    <canvas id="canvas"></canvas>

    <script>
      // ページが読み込まれた後に実行
      window.onload = function() {
        // Canvas要素と描画コンテキストの取得
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        // ファイル選択時の処理
        document.getElementById('fileInput').addEventListener('change', function(e) {
          const file = e.target.files[0];
          const reader = new FileReader();

          reader.onload = function(event) {
            // 画像読み込み後の処理
            const image = new Image();
            image.onload = function() {
              // 画像をCanvasに描画
              canvas.width = image.width;
              canvas.height = image.height;
              context.drawImage(image, 0, 0);

              // モザイク効果をかける
              mosaicEffect(context, 50);

              // モザイク後の画像を表示
              const mosaicImage = canvas.toDataURL();
              const resultImage = new Image();
              resultImage.src = mosaicImage;
              document.body.appendChild(resultImage);
            };

            image.src = event.target.result;
          };

          reader.readAsDataURL(file);
        });

        // モザイク効果をかける関数
        function mosaicEffect(ctx, blockSize) {
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;

          for (let y = 0; y < canvas.height; y += blockSize) {
            for (let x = 0; x < canvas.width; x += blockSize) {
              const red = data[(y * canvas.width + x) * 4];
              const green = data[(y * canvas.width + x) * 4 + 1];
              const blue = data[(y * canvas.width + x) * 4 + 2];

              for (let i = 0; i < blockSize; i++) {
                for (let j = 0; j < blockSize; j++) {
                  const pixelIndex = ((y + i) * canvas.width + (x + j)) * 4;
                  data[pixelIndex] = red;
                  data[pixelIndex + 1] = green;
                  data[pixelIndex + 2] = blue;
                }
              }
            }
          }

          ctx.putImageData(imageData, 0, 0);
        }
      };
    </script>
  </body>
</html>
